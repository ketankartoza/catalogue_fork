{% extends "base-fluid.html" %}
{% load url from future %} {# https://docs.djangoproject.com/en/1.4/releases/1.3/#changes-to-url-and-ssi #}
{% load staticfiles %}

{% block extrajs %}

  {{ block.super }}
  <script type="text/javascript" charset="utf-8" src="{% static 'js/jquery.form.js' %}"></script>
  <script type="text/javascript" charset="utf-8" src="{% static 'js/widget.searchcriteria.js' %}"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      // block();
      // $('#search-form-container').load('/rendersearchform/',"",unblock);
      var theguid = '{{ theGuid }}';

      $('#map-container').load('/rendersearchmap/');
      $('#myTab  a:first').tab('show');
      $('#search-results').hide();
      {% if not user.is_anonymous %}
        $("#cart_tab").load("/showminicartcontents/");
      {% endif %}

      // initialize row click callback
      setupRowClickCallback();

      // initialize showMetadata Dialog
      setupMetadataDialog();

      // initialize show preview on cart
      setupMiniIconClickCallback();

      // initialize search criteria display
      $('#search_criteria_display').searchcriteria();
      if (theguid != '') {
        block();
        search_guid = theguid;
        loadSearchResults( 1, theguid );
      }
    });
  </script>

{% endblock %}

{% block body_load %}{% endblock %}

{% block content%}
    <div class="row-fluid">
        <div id="search-panel" class="span3" style="min-width: 238px;">
            <ul class="nav nav-tabs" id="myTab">
              <li class="active"><a href="#search_tab" data-toggle="tab">Search</a></li>
              <li><a id="cart_title" href="#cart_tab" data-toggle="tab">Cart (0)</a></li>
              <li><a id="preview" href="#preview_tab" data-toggle="tab">Preview</a></li>
            </ul>
            <div class="tab-content">
              <div id="search_tab" class="tab-pane active">
                <div>
                  <p>
                  <div onClick="resetSearchForm();" class="btn btn-warning btn-small" class="default" name="_reset" title="Click here to reset your search."><i class="icon-refresh"></i> Reset</div>
                  <div onClick="submitSearchForm();" class="btn btn-success btn-small" class="default" name="_search" title="Click here to execute your search."><i class="icon-search"></i> Search</div>
                  </p>
                </div>
                <div id="search-form-container">
                  {% if myForm %}
                    {% include "searchPanelv3.html" %}
                  {% endif %}
                </div>
              </div>
              <div id="cart_tab" class="tab-pane">
                You must login to order products!
              </div>
              <div id="preview_tab" class="tab-pane">
              </div>
            </div>
        </div>
        <div class="span9" style="margin-left: 5px; margin-right:0px;">
            <div class="row-fluid">
                <div id="map-container" class="span12">
                </div>
            </div>
            <div class="row-fluid">
              <div id="search-results-text" class="span12">
                <div class="accordion" id="accordion-search-text">
                  <div class="accordion-group">
                    <div class="accordion-heading">
                      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-search-text" href="#collapsesearch-text">
                        Search parameters
                      </a>
                    </div>
                    <div id="collapsesearch-text" class="accordion-body collapse in">
                      <div id="search_criteria_display" class="accordion-inner">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row-fluid">
              <div id="search-results" class="span12">
                <div class="accordion" id="accordion-search-results">
                  <div class="accordion-group">
                    <div class="accordion-heading">
                      <div style="position:relative; float:left;">
                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-search-results" href="#collapsesearch-results">
                          Search results
                        </a>
                      </div>
                      <div class="btn-group" style="position:relative; float:left; padding: 4px 5px;">
                        <a class="btn dropdown-toggle btn-small btn-info" data-toggle="dropdown" href="#">
                          Download
                          <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                          <li><a href="javascript: location='/downloadsearchresults/' + search_guid + '/?shp'">SHP</a></li>
                          <li><a href="javascript: location='/downloadsearchresults/' + search_guid + '/?kml'">KML</a></li>
                          <li><a href="javascript: location='/downloadsearchresults/' + search_guid + '/?kmz'">KMZ</a></li>
                          <li class="divider"></li>
                          <li><a href="javascript: location='/downloadsearchmetadata/' + search_guid + '/'">XML</a></li>
                          <li><a href="javascript: location='/downloadsearchmetadata/' + search_guid + '/?html'">HTML</a></li>
                        </ul>
                      </div>
                    </div>
                    <div id="collapsesearch-results" class="accordion-body collapse in" style="clear: left;">
                      <div class="accordion-inner">
                        <div id="search-results-container" class="span12">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
    </div>
    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <h3 id="myModalLabel">Metadata</h3>
        </div>
        <div class="modal-body" id="modalContainer">
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
      </div>
{% endblock%}