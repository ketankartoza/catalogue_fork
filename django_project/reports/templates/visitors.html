{% extends "base.html" %}
{# Original code from Tim's SABIO project and copyright is retained by the original author #}

{% block content %}
{% if myRecords %}
<div id="visitors-content">
  <div class="row-fluid">
    <h2>Visitor List</h2>
  </div>
  <div class="row-fluid gap-bottom center">
    <button onclick="location='?pdf'" class="btn" id="download-btn"><i class="icon-download"></i> Download as PDF</button>
    <span class="step-links btn-group">
      {% if myRecords.has_previous %}
        <a href="{% url 'visitorList' %}?page={{ myRecords.previous_page_number }}" class="previous-btn btn"><i class="icon-chevron-left"></i></a>
      {% else %}
          <a href="#" class="previous-btn btn disabled"><i class="icon-chevron-left"></i></a>
      {% endif %}
      <span class="current btn  disabled btn-success">
        {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
      </span>
      {% if myRecords.has_next %}
        <a href="{% url 'visitorList' %}?page={{ myRecords.next_page_number }}" class="next-btn btn"><i class="icon-chevron-right"></i></a>
      {% else %}
        <a href="#" class="previous-btn btn disabled"><i class="icon-chevron-right"></i></a>
      {% endif %}
    </span>
  </div>
  <div class="row-fluid" id="visitors-content">
    <table id="gradient-style" summary="Visitors List" class="table table-striped">
      <thead>
      </thead>
      <tfoot>
      </tfoot>
      <tbody>
        <tr>
          <th>User</th>
          <th>IP Address</th>
          <th>Country</th>
          <th>City</th>
          <th>Date</th>
        </tr>
        {% for myRecord in myRecords.object_list %}
        <tr>
          <td>
            {% if myRecord.user.first_name and myRecord.user.last_name %}
              {{ myRecord.user.first_name}} {{myRecord.user.last_name}}
            {% else %}
              {{ myRecord.user.username }}
            {% endif %}
          </td>
          <td>{{ myRecord.ip_address }}</td>
          <td>{{ myRecord.country}}</td>
          <td>{{ myRecord.city }}</td>
          <td>{{ myRecord.visit_date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="row-fluid center">
      <span class="step-links btn-group">
      {% if myRecords.has_previous %}
        <a href="{% url 'visitorList' %}?page={{ myRecords.previous_page_number }}" class="previous-btn btn"><i class="icon-chevron-left"></i></a>
      {% else %}
          <a href="#" class="previous-btn btn disabled"><i class="icon-chevron-left"></i></a>
      {% endif %}
      <span class="current btn  disabled btn-success">
        {{ myRecords.number }} of {{ myRecords.paginator.num_pages }}
      </span>
      {% if myRecords.has_previous %}
        <a href="{% url 'visitorList' %}?page={{ myRecords.next_page_number }}" class="next-btn btn "><i class="icon-chevron-right"></i></a>
      {% else %}
        <a href="#" class="previous-btn btn disabled"><i class="icon-chevron-right"></i></a>
      {% endif %}
      </span>
    </div>
  </div>
  {% else %}
  <p>No visitors are available.</p>
  {% endif %}
</div>
<script>
$('#download-btn').popover({
  placement:'left',
  trigger:'hover',
  content:'Click to download the entire list of visitors in PDF format',
  title:'Download as PDF'
});
{% if myRecords.has_previous %}
$('.previous-btn').tooltip({
  placement:'top',
  title:'Previous Page'
});
{% endif %}
{% if myRecords.has_next %}
$('.next-btn').tooltip({
  placement:'top',
  title:'Next Page'
});
{% endif %}
</script>
{% endblock %}
